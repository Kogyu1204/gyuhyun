<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://fonts.googleapis.com/css?family=Jua&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    
    <title>블랙핑크 닮은꼴 찾기</title>
    <meta name="title" content="블랙핑크 닮은꼴 찾기">
    <meta name="subject" content="나와 닮은 블랙핑크 맴버를 찾아보세요!">
    <meta name="keywords" content="블랙핑크 닮은꼴 찾기, 인공지능 블랙핑크 닮은꼴 찾기, 나와 닮은 연예인, 가수 찾기, 얼굴 평가, blackpink, 제니, 리사, 로제, 지수">
    <meta name="author" content="코난쌤">
    <link rel="stylesheet" href="style.css">
    <link rel="canonical" href="https://blackpinktest.netlify.app/" />
    <meta property="og:url" content="https://blackpinktest.netlify.app/" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="블랙핑크 닮은꼴" />
    <meta property="og:description" content="블랙핑크 닮은꼴 찾기, 인공지능 블랙핑크 닮은꼴 찾기, 나와 닮은 연예인, 가수 찾기, 얼굴 평가, blackpink, 제니, 리사, 로제, 지수"
    />
    <meta property="og:image" content="./thumnail.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e64b3727e862b06"></script>
</head>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

<script type="text/javascript">
    // More API functions here:
    // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

    // the link to your model provided by Teachable Machine export panel
    const URL = "https://teachablemachine.withgoogle.com/models/Qu5pcMy0Z/";

    let model, labelContainer, maxPredictions;

    // Load the image model and setup the webcam
    async function init() {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";

        // load the model and metadata
        // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
        // or files from your local hard drive
        // Note: the pose library adds "tmImage" object to your window (window.tmImage)
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        // Convenience function to setup a webcam
        // const flip = true; // whether to flip the webcam
        // webcam = new tmImage.Webcam(200, 200, flip); // width, height, flip
        // await webcam.setup(); // request access to the webcam
        // await webcam.play();
        // window.requestAnimationFrame(loop);

        // append elements to the DOM
        labelContainer = document.getElementById("label-container");
        for (let i = 0; i < maxPredictions; i++) { // and class labels
            labelContainer.appendChild(document.createElement("div"));
        }
    }

    // async function loop() {
    //     webcam.update(); // update the webcam frame
    //     await predict();
    //     window.requestAnimationFrame(loop);
    // }

    // run the webcam image through the image model
    async function predict() {
        // predict can take in an image, video or canvas html element
        var imgs=document.getElementById("face-image"); //첨부이미지 가져오기
        const prediction = await model.predict(imgs,false);
        prediction.sort((a, b) => parseFloat(b.probability) - parseFloat(a.probability));
        //결과 표시
        for (let i = 0; i < maxPredictions; i++) {
            const classPrediction =
                prediction[i].className + ": " + prediction[i].probability.toFixed(2);
            labelContainer.childNodes[i].innerHTML = classPrediction;
        }
        //이렇게 추가하기
                var labelTitle;
                switch (prediction[i].className) {
                    case "dog":
                        labelTitle = "강아지"
                        break;
                    case "cat":
                        labelTitle = "고양이"
                        break;
                    case "bird":
                        labelTitle = "새"
                        break;
                    default:
                        labelTitle = "알수없음"
                }
             
            var title = "<div class='" + prediction[0].className + "-animal-title'>" + resultTitle + "</div>"
            var explain = "<div class='animal-explain pt-2'>" + resultExplain + "</div>"
            var celeb = "<div class='" + prediction[0].className + "-animal-celeb pt-2 pb-2'>" + resultCeleb + "</div>"
            $('.result-message').html(title + explain + celeb);
            var barWidth;
            
            for (let i = 0; i < maxPredictions; i++) {
                if (prediction[i].probability.toFixed(2) > 0.1) {
                    barWidth = Math.round(prediction[i].probability.toFixed(2) * 100) + "%";
                } else if (prediction[i].probability.toFixed(2) >= 0.01) {
                    barWidth = "4%"
                } else {
                    barWidth = "2%"
                }
                var labelTitle;
                switch (prediction[i].className) {
                    case "dog":
                        labelTitle = "강아지"
                        break;
                    case "cat":
                        labelTitle = "고양이"
                        break;
                    case "bird":
                        labelTitle = "새"
                        break;
                    default:
                        labelTitle = "알수없음"
                }
                var label = "<div class='animal-label d-flex align-items-center'>" + labelTitle + "</div>"
                
                // 게이지바 계산
                var bar = "<div class='bar-container position-relative container'><div class='" + prediction[i].className + "-box'></div><div class='d-flex justify-content-center align-items-center " + prediction[i].className + "-bar' style='width: " + barWidth + "'><span class='d-block percent-text'>" + Math.round(prediction[i].probability.toFixed(2) * 100) + "%</span></div></div>"
                labelContainer.childNodes[i].innerHTML = label + bar;
            } 
    }
    </script>
<!-- 티처블머신 코드 끝 -->
<!-- 코드펜 js -->
<script>
  function readURL(input) {
  if (input.files && input.files[0]) {

    var reader = new FileReader();

    reader.onload = function(e) {
      $('.image-upload-wrap').hide();
      $('#loading').show();
      $('.file-upload-image').attr('src', e.target.result);
      $('.file-upload-content').show();

      $('.image-title').html(input.files[0].name);
    };

    reader.readAsDataURL(input.files[0]);
    init().then(function() {
      console.log("hi");
      predict();
      $('#loading').hide();
    })

  } else {
    removeUpload();
  }
}

function removeUpload() {
  $('.file-upload-input').replaceWith($('.file-upload-input').clone());
  $('.file-upload-content').hide();
  $('.image-upload-wrap').show();
}
$('.image-upload-wrap').bind('dragover', function () {
		$('.image-upload-wrap').addClass('image-dropping');
	});
	$('.image-upload-wrap').bind('dragleave', function () {
		$('.image-upload-wrap').removeClass('image-dropping');
});
</script>
<!-- 코드펜에서 붙여넣기 -->
<script class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<div class="file-upload">
  <!-- <button class="file-upload-btn" type="button" onclick="$('.file-upload-input').trigger( 'click' )">사진올리셈</button> -->
  <div class="mt-3 container file-upload">
  <div class="image-upload-wrap">
    <input class="file-upload-input" type='file' onchange="readURL(this);" accept="image/*" />
    <div class="drag-text">
      <img src="./upload.svg" class="mt-5 pt-5 upload">
      <h3 class="mb-5 pb-5 pt-4  upload-text">사진드래그하셈</h3>
    </div>
  </div>
  
  <div class="file-upload-content">
    <img class="file-upload-image" id="face-image" src="#" alt="your image" />
  <div id="label-container"></div>
    <div id="loading" class="animated bounce">
      <div class="spinner-border" role="status">
      </div>
      <p class="text-center">AI가 당신의 얼굴을 분석중입니다.</p>
    </div>
  </body>
</html>